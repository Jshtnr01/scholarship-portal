<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up - Scholarship System</title>
  <link rel="stylesheet" href="sign-up.css">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-green-100 to-green-200 mt-6 min-h-screen flex items-start justify-center font-sans overflow-hidden">

  <div class="signup-container flex bg-white shadow-xl rounded-2xl overflow-hidden w-[850px] min-h-[570px]">
    <!-- Branding Section -->
    <div class="branding-section w-1/2 bg-cover bg-center flex flex-col items-center justify-center text-white p-4"
      style="background-image: url('images/signupBG.jpg');">
    </div>

    <!-- Form Section -->
    <div class="form-section w-1/2 p-4 flex flex-col justify-center">
      <h1 class="text-xl font-bold text-green-700 mb-1">Create Account</h1>
      <p class="subtitle mb-3 text-gray-600 text-xs">Join the scholarship portal today</p>

      <!-- Role Selection -->
      <div class="mb-4">
        <label for="role" class="block font-medium text-gray-700 text-sm">Select Role</label>
        <select id="role" class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none text-sm">
          <option value="">-- Choose Role --</option>
          <option value="applicant">Applicant</option>
          <option value="admin">Admin</option>
        </select>
      </div>

      <!-- Applicant Signup Form -->
      <form id="applicant-form" class="signup-form space-y-2 text-xs hidden">
        <div>
          <label for="fullname" class="block font-medium text-gray-700">Full Name</label>
          <input type="text" id="fullname" name="fullname" placeholder="Enter your full name" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="birthdate" class="block font-medium text-gray-700">Birthdate</label>
          <input type="date" id="birthdate" name="birthdate" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="age" class="block font-medium text-gray-700">Age</label>
          <input type="number" id="age" name="age" min="10" max="100" placeholder="Enter your age" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="contact" class="block font-medium text-gray-700">Contact Number</label>
          <input type="tel" id="contact" name="contact" placeholder="09XXXXXXXXX" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="email" class="block font-medium text-gray-700">Email</label>
          <input type="email" id="email" name="email" placeholder="youremail@gmail.com" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="password" class="block font-medium text-gray-700">Password</label>
          <input type="password" id="password" name="password" placeholder="Enter your password" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="confirm-password" class="block font-medium text-gray-700">Confirm Password</label>
          <input type="password" id="confirm-password" name="confirm_password" placeholder="Confirm your password" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <button type="submit" 
          class="btn bg-green-600 text-white w-full py-1.5 rounded-md hover:bg-green-700 transition text-sm">
          Sign Up as Applicant
        </button>
      </form>

      <!-- Admin Signup Form -->
      <form id="admin-form" class="signup-form space-y-2 text-xs hidden">
        <div>
          <label for="admin-name" class="block font-medium text-gray-700">Full Name</label>
          <input type="text" id="admin-name" name="fullname" placeholder="Enter full name" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="admin-email" class="block font-medium text-gray-700">Email</label>
          <input type="email" id="admin-email" name="email" placeholder="admin@email.com" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="admin-contact" class="block font-medium text-gray-700">Contact Number</label>
          <input type="tel" id="admin-contact" name="contact" placeholder="09XXXXXXXXX" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="admin-dept" class="block font-medium text-gray-700">Department / Position</label>
          <input type="text" id="admin-dept" name="department" placeholder="Enter department or position" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="admin-password" class="block font-medium text-gray-700">Password</label>
          <input type="password" id="admin-password" name="password" placeholder="Enter password" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <div>
          <label for="admin-confirm-password" class="block font-medium text-gray-700">Confirm Password</label>
          <input type="password" id="admin-confirm-password" name="confirm_password" placeholder="Confirm password" 
            class="w-full border border-gray-300 p-1.5 rounded-md focus:ring-2 focus:ring-green-400 focus:outline-none" required>
        </div>

        <button type="submit" 
          class="btn bg-green-600 text-white w-full py-1.5 rounded-md hover:bg-green-700 transition text-sm">
          Sign Up as Admin
        </button>
      </form>

      <p class="login-link mt-3 text-center text-gray-700 text-xs">
        Already have an account? 
        <a href="login.html" class="text-green-600 font-semibold hover:underline">Log In</a>
      </p>
    </div>
  </div>

  <!-- Supabase Script -->
<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  const SUPABASE_URL = "https://evhccomzwzcwtlzjkcig.supabase.co";
  const SUPABASE_ANON_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV2aGNjb216d3pjd3RsemprY2lnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NDg2NjcsImV4cCI6MjA3MjIyNDY2N30.GL3cvUlJs7woFRXBgc0x3JAH93ZysfbN7jmbamcnb8c";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // Elements
  const roleSelect = document.getElementById("role");
  const applicantForm = document.getElementById("applicant-form");
  const adminForm = document.getElementById("admin-form");

  // Toggle forms
  roleSelect.addEventListener("change", () => {
    applicantForm.classList.add("hidden");
    adminForm.classList.add("hidden");

    if (roleSelect.value === "applicant") {
      applicantForm.classList.remove("hidden");
    } else if (roleSelect.value === "admin") {
      adminForm.classList.remove("hidden");
    }
  });

  // ---------------- Applicant Signup ----------------
applicantForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const fullname = document.getElementById("fullname").value;
  const birthdate = document.getElementById("birthdate").value;
  const age = document.getElementById("age").value;
  const contact = document.getElementById("contact").value;
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const confirmPassword = document.getElementById("confirm-password").value;

  if (password !== confirmPassword) {
    alert("Passwords do not match!");
    window.location.reload(); // refresh on failure
    return;
  }

  const { data, error } = await supabase.auth.signUp({ email, password });

  if (error) {
    alert("Error: " + error.message);
    window.location.reload(); // refresh on failure
    return;
  }

  const userId = data?.user?.id;
  if (!userId) {
    alert("Signup successful. Please verify your email before continuing.");
    window.location.href = "login.html"; // redirect to login
    return;
  }

  const { error: insertError } = await supabase
    .from("userprofiles")
    .insert([
      {
        id: userId,
        role: "applicant",
        fullname,
        birthdate,
        age,
        contact,
      },
    ]);

  if (insertError) {
    alert("Error saving applicant info: " + insertError.message);
    window.location.reload(); // refresh on failure
  } else {
    alert("Applicant signup successful! Please log in.");
    window.location.href = "login.html"; // redirect on success
  }
});

// ---------------- Admin Signup ----------------
adminForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const fullname = document.getElementById("admin-name").value;
  const email = document.getElementById("admin-email").value;
  const contact = document.getElementById("admin-contact").value;
  const department = document.getElementById("admin-dept").value;
  const password = document.getElementById("admin-password").value;
  const confirmPassword = document.getElementById("admin-confirm-password").value;

  if (password !== confirmPassword) {
    alert("Passwords do not match!");
    window.location.reload(); // refresh on failure
    return;
  }

  const { data, error } = await supabase.auth.signUp({ email, password });

  if (error) {
    alert("Error: " + error.message);
    window.location.reload(); // refresh on failure
    return;
  }

  const userId = data?.user?.id;
  if (!userId) {
    alert("Signup successful. Please verify your email before continuing.");
    window.location.href = "login.html"; // redirect to login
    return;
  }

  const { error: insertError } = await supabase
    .from("adminprofiles")
    .insert([
      {
        id: userId,
        role: "admin",
        fullname,
        email,
        contact,
        department,
      },
    ]);

  if (insertError) {
    alert("Error saving admin info: " + insertError.message);
    window.location.reload(); // refresh on failure
  } else {
    alert("Admin signup successful! Please log in.");
    window.location.href = "login.html"; // redirect on success
  }
});

</script>

</body>
</html>
